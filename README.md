# Document Processing Pipeline with AWS CDK

This CDK project implements a document processing pipeline that uses AWS services to extract text and data from various document types, create metadata, and prepare the content for a Bedrock knowledge base.

## Architecture

The solution includes the following components:

1. **S3 Buckets**:
   - Document Bucket: Stores original uploaded documents
   - Processed Document Bucket: Stores processed documents optimized for Bedrock knowledge base

2. **Lambda Functions**:
   - Textract Processor: Extracts text and data from documents using AWS Textract
   - Metadata Extractor: Creates and stores metadata in DynamoDB
   - Bedrock Knowledge Base: Integrates with Amazon Bedrock for knowledge base creation and querying

3. **DynamoDB Tables**:
   - Document Metadata Table: Stores document metadata
   - Search Index Table: Stores search indices for improved document searchability

4. **Step Functions**:
   - Document Processing State Machine: Orchestrates the document processing workflow

5. **IAM Roles and Permissions**:
   - Appropriate IAM roles and permissions for each component

## Image Handling Capabilities

This solution includes enhanced image handling capabilities:

1. **Image Text Extraction**: Extracts text from images using AWS Textract
2. **Image Metadata**: Creates metadata for images including descriptions generated by Bedrock
3. **Image Search**: Enables searching for images based on their text content
4. **Image Retrieval**: Returns relevant images when querying for content that appears in those images
5. **Image References**: Provides presigned URLs for accessing images in query responses

## Prerequisites

- AWS CDK installed
- Node.js and npm installed
- AWS CLI configured with appropriate credentials
- AWS account with access to Textract, Bedrock, and other required services

## Deployment

1. Install dependencies:
   ```
   npm install
   ```

2. Build the project:
   ```
   npm run build
   ```

3. Deploy the stack:
   ```
   cdk deploy
   ```

## Usage

1. **Upload Documents**:
   Upload documents to the Document Bucket. Supported formats include:
   - PDF
   - Images (PNG, JPG, JPEG, TIFF)
   - Word documents (DOC, DOCX)
   - Excel spreadsheets (XLS, XLSX)
   - Text files (TXT)
   - CSV files

2. **Document Processing**:
   - The upload triggers a Lambda function that starts the Step Functions state machine
   - Textract extracts text, tables, and forms from the document
   - Metadata is generated using Bedrock LLM
   - The processed document and metadata are stored in the appropriate locations

3. **Query the Knowledge Base**:
   - Use the Bedrock Knowledge Base Lambda function to query the processed documents
   - The function returns relevant information based on natural language queries
   - If the query matches text in an image, the image will be included in the response

## Customization

You can customize the solution by modifying the following:

- Lambda function code in the `lambda` directory
- CDK stack configuration in `lib/document-processing-cdk-stack.ts`
- Step Functions workflow definition in the stack

## Cleanup

To remove all resources created by this CDK stack:

```
cdk destroy
```

Note: S3 buckets and DynamoDB tables are configured with a removal policy of RETAIN to prevent accidental data loss. You'll need to manually delete these resources if desired.
